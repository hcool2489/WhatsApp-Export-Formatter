<html>
	<head>
		<title>WhatsApp Export Formatter</title>
	</head>
	<body>
		<div id="hide">
		<p>Select a file from your computer to being read as text.</p>
		<input type="file" id="filetoRead">
		</div>
		<script>
			function format(res){
				res = res.split('\n');
				var jsonData = [];
				for(i=0,j=-1;i<res.length;i++){
					if(res[i].search(/^(0?[1-9]|1[0-2])[\/](0?[1-9]|[12]\d|3[01])[\/]\d{2}, ([0-9]|0[0-9]|1[0-9]):[0-9]{2} (AM|PM) - /) == 0){
						j++;
						var newChat = res[i].match(/^(\d{1}|\d{2})[\/](\d{1}|\d{2})[\/](\d{2}), (\d{1}|\d{2}):(\d{1}|\d{2}) (AM|PM) - /);
						jsonData.push({
							day: newChat[2],
							month: newChat[1],
							year: newChat[3],
							hour: newChat[4],
							minute: newChat[5],
							meridiem: newChat[6],
							sender: "",
							message: ""
						});
						newChat = res[i].replace(/^(\d{1}|\d{2})[\/](\d{1}|\d{2})[\/](\d{2}), (\d{1}|\d{2}):(\d{1}|\d{2}) (AM|PM) - /, '');
						if(newChat.search(/([a-zA-Z0-9-_]{1,20}): /) == 0){
							jsonData[j].sender = newChat.match(/([a-zA-Z0-9-_]{1,20}): /)[1];
							jsonData[j].message = newChat.replace(/([a-zA-Z0-9-_]{1,20}): /, '');
						}else{
							jsonData[j].sender = "info";
							jsonData[j].message = newChat;
						}
					}else{
						jsonData[j].message = jsonData[j].message + '\n' + res[i];
					}
				}
				console.log(jsonData);
			}
			document.getElementById("filetoRead").addEventListener("change",function(){
				var file = this.files[0];
				if (file) {
					var reader = new FileReader();
					reader.onload = function (evt) {
						document.getElementById("hide").style.display = "none";
						format(evt.target.result);
					};
					reader.onerror = function (evt) {
						console.error("An error ocurred reading the file",evt);
					};
					reader.readAsText(file, "UTF-8");
				}
			},false);
		</script>
	</body>
</html>